{% extends 'base.html' %}
{% block content %}
  <h1>Welcome to {{ config.APP_NAME }}</h1>
  {% if msg %}
    <p class="success">{{ msg }}</p>
  {% endif %}
  {% if err %}
    <p class="error">{{ err }}</p>
  {% endif %}
  <h2>Create account</h2>
  <form method="POST" action="{{ url_for('register') }}" onsubmit="return validateForm(event, 'register')">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required>
    <label for="captcha">CAPTCHA: {{ captcha_q }} = </label>
    <input type="text" id="captcha" name="captcha" required>
    <button type="submit">Register</button>
  </form>
  <h2>Login</h2>
  <form method="POST" action="{{ url_for('login') }}" onsubmit="return validateForm(event, 'login')">
    <label for="login_email">Email:</label>
    <input type="email" id="login_email" name="email" required>
    <label for="login_password">Password:</label>
    <input type="password" id="login_password" name="password" required>
    <button type="submit">Login</button>
  </form>
  <p>
    <a href="{{ url_for('forgot_password') }}">Forgot password?</a> Â· 
    <a href="{{ url_for('admin') }}">Admin</a>
  </p>
{% endblock %}
{% block scripts %}
  <script>
    function validateForm(event, formType) {
      event.preventDefault();
      const form = event.target;
      const inputs = formType === 'register' 
        ? [form.querySelector('#name'), form.querySelector('#email'), form.querySelector('#password'), form.querySelector('#captcha')]
        : [form.querySelector('#login_email'), form.querySelector('#login_password')];
      let valid = true;
      inputs.forEach(input => {
        if (!input) return;
        input.value = input.value.trim();
        if (!input.value) {
          valid = false;
          alert('All fields are required');
        }
      });
      if (valid) {
        form.submit();
      }
      return valid;
    }
  </script>
{% endblock %}
