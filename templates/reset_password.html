{% extends 'base.html' %}
{% block content %}
  <h1>Reset Password</h1>
  {% if msg %}
    <p class="success">{{ msg }}</p>
  {% endif %}
  {% if err %}
    <p class="error">{{ err }}</p>
  {% endif %}
  <form method="POST" action="{{ url_for('reset_password') }}" onsubmit="return validateForm(event)">
    <label for="otp">OTP (sent to {{ email }}):</label>
    <input type="text" id="otp" name="otp" required>
    <label for="password">New Password:</label>
    <input type="password" id="password" name="password" required>
    <label for="confirm">Confirm Password:</label>
    <input type="password" id="confirm" name="confirm" required>
    <button type="submit">Reset Password</button>
  </form>
  <form method="POST" action="{{ url_for('resend_otp') }}">
    <button type="submit">Resend OTP</button>
  </form>
  <p><a href="{{ url_for('index') }}">Back to Login</a></p>
{% endblock %}
{% block scripts %}
  <script>
    function validateForm(event) {
      event.preventDefault();
      const form = event.target;
      const otp = form.querySelector('#otp');
      const password = form.querySelector('#password');
      const confirm = form.querySelector('#confirm');
      otp.value = otp.value.trim();
      password.value = password.value.trim();
      confirm.value = confirm.value.trim();
      if (!otp.value || !password.value || !confirm.value) {
        alert('All fields are required');
        return false;
      }
      if (password.value !== confirm.value) {
        alert('Passwords do not match');
        return false;
      }
      form.submit();
      return true;
    }
  </script>
{% endblock %}
