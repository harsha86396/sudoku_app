{% extends 'base.html' %}
{% block content %}
  <h1>Reset Password</h1>
  <p>We sent an OTP to {{ email }}. Enter it below and choose a new password.</p>
  {% if msg %}
    <p class="success">{{ msg }}</p>
  {% endif %}
  {% if err %}
    <p class="error">{{ err }}</p>
  {% endif %}
  <form method="POST" action="{{ url_for('reset_password') }}" onsubmit="validateForm(event)">
    <label for="otp">OTP Code:</label>
    <input type="text" id="otp" name="otp" required>
    <label for="password">New Password:</label>
    <input type="password" id="password" name="password" required>
    <label for="confirm">Confirm Password:</label>
    <input type="password" id="confirm" name="confirm" required>
    <button type="submit">Reset Password</button>
    <button type="submit" formaction="{{ url_for('resend_otp') }}">Resend OTP</button>
  </form>
  {% block scripts %}
    <script>
      function validateForm(event) {
        event.preventDefault();
        const form = event.target;
        document.querySelectorAll('input').forEach(input => {
          input.value = input.value.trim();
          if (!input.value) {
            alert('All fields are required');
            event.preventDefault();
            return;
          }
        });
        form.submit();
      }
    </script>
  {% endblock %}
{% endblock %}
